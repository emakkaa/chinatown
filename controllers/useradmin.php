<?phpclass UserAdmin extends Controller{	public $user;		function __construct($action)	{		parent::__construct($action);		$this->setModel('user');				$u = new User;		$u->load($_SESSION['user']);		$this->user = $u->getProperties();	}		function defaultAction()	{		$this->showList();	}		function showList()	{		$where = "AND u.access_level < ".$_SESSION['access'];		$users = $this->_model->select("u.id, first_name, last_name, role_name",							"users u							LEFT JOIN roles r ON r.id = u.role_id",							"u.deleted = 0 $where", 							"u.access_level DESC, first_name, last_name");		$this->_template->setView('users');		$array = array(			"title"=>$this->lang['System users'],			"users"=>$users		);	    $this->_template->render($array);	}		function edit()	{		if (isset($_REQUEST['id']))		{			$this->_model->load((int)$_REQUEST['id']);					}				$query = "SELECT id, role_name FROM roles WHERE access_level <".$_SESSION['access']." ORDER BY access_level";		if (($_SESSION['access'] >= 600) && ($_SESSION['access'] <= 700))		{			$query .= " AND access_level >= 500";		}		$roles = $this->SQL->query($query);				$this->_template->setView('user_edit');		$array = array(			"user"=>$this->_model->getProperties(),			"roles"=>$roles		);	    $this->_template->simpleRender($array);	}		function save()	{		$this->_model->loadFrom($_POST);		$this->_model->getAccessByRole();		$this->_model->save();		$this->showList();	}		function delete()	{		if (isset($_REQUEST['user']))		{			$id = (int)$_REQUEST['user'];			$this->_model->delete($id);			echo "OK";		}	}		function checkUsername()	{		if ((isset($_REQUEST['user_name'])) && (isset($_REQUEST['id'])))		{			$result = $this->SQL->query("SELECT COUNT(id) FROM users WHERE user_name = '".$_REQUEST['user_name']."' AND id != '".$_REQUEST['id']."' AND deleted = 0");			$row = $result->fetch_row();			if ($row[0])			{				echo 'Username is in use';			}			else			{				echo 'OK';			}		}	}}?>